import{s as wt,p as re,z as ae,i as $e,d as ce,a as $t,b as It,t as Ie}from"./vendor-D_PPZnq5.js";const At={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:t=>`Node type "${t}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:t=>`The old edge with id=${t} does not exist.`,error009:t=>`Marker type "${t}" doesn't exist.`,error008:(t,{id:e,sourceHandle:i,targetHandle:s})=>`Couldn't create edge for ${t} handle id: "${t==="source"?i:s}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:t=>`Edge type "${t}" not found. Using fallback type "default".`,error012:t=>`Node with id "${t}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(t="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${t}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Ce=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],bn=["Enter"," ","Escape"],ve={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:t,x:e,y:i})=>`Moved selected node ${t}. New position, x: ${e}, y: ${i}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var pt;(function(t){t.Strict="strict",t.Loose="loose"})(pt||(pt={}));var dt;(function(t){t.Free="free",t.Vertical="vertical",t.Horizontal="horizontal"})(dt||(dt={}));var Rt;(function(t){t.Partial="partial",t.Full="full"})(Rt||(Rt={}));const En={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Gt;(function(t){t.Bezier="default",t.Straight="straight",t.Step="step",t.SmoothStep="smoothstep",t.SimpleBezier="simplebezier"})(Gt||(Gt={}));var St;(function(t){t.Arrow="arrow",t.ArrowClosed="arrowclosed"})(St||(St={}));var Y;(function(t){t.Left="left",t.Top="top",t.Right="right",t.Bottom="bottom"})(Y||(Y={}));const qt={[Y.Left]:Y.Right,[Y.Right]:Y.Left,[Y.Top]:Y.Bottom,[Y.Bottom]:Y.Top};function Hn(t){return t===null?null:t?"valid":"invalid"}const Pe=t=>"id"in t&&"source"in t&&"target"in t,Tn=t=>"id"in t&&"position"in t&&!("source"in t)&&!("target"in t),Yt=t=>"id"in t&&"internals"in t&&!("source"in t)&&!("target"in t),yt=(t,e=[0,0])=>{const{width:i,height:s}=rt(t),n=t.origin??e,r=i*n[0],o=s*n[1];return{x:t.position.x-r,y:t.position.y-o}},$n=(t,e={nodeOrigin:[0,0]})=>{if(t.length===0)return{x:0,y:0,width:0,height:0};const i=t.reduce((s,n)=>{const r=typeof n=="string";let o=!e.nodeLookup&&!r?n:void 0;e.nodeLookup&&(o=r?e.nodeLookup.get(n):Yt(n)?n:e.nodeLookup.get(n.id));const a=o?mt(o,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return Mt(s,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return bt(i)},le=(t,e={})=>{let i={x:1/0,y:1/0,x2:-1/0,y2:-1/0},s=!1;return t.forEach(n=>{(e.filter===void 0||e.filter(n))&&(i=Mt(i,mt(n)),s=!0)}),s?bt(i):{x:0,y:0,width:0,height:0}},In=(t,e,[i,s,n]=[0,0,1],r=!1,o=!1)=>{const a={...Xt(e,[i,s,n]),width:e.width/n,height:e.height/n},l=[];for(const u of t.values()){const{measured:f,selectable:c=!0,hidden:d=!1}=u;if(o&&!c||d)continue;const p=f.width??u.width??u.initialWidth??null,h=f.height??u.height??u.initialHeight??null,g=zt(a,Et(u)),b=(p??0)*(h??0),m=r&&g>0;(!u.internals.handleBounds||m||g>=b||u.dragging)&&l.push(u)}return l},Ae=(t,e)=>{const i=new Set;return t.forEach(s=>{i.add(s.id)}),e.filter(s=>i.has(s.source)||i.has(s.target))};function Ne(t,e){const i=new Map,s=e!=null&&e.nodes?new Set(e.nodes.map(n=>n.id)):null;return t.forEach(n=>{n.measured.width&&n.measured.height&&((e==null?void 0:e.includeHiddenNodes)||!n.hidden)&&(!s||s.has(n.id))&&i.set(n.id,n)}),i}async function Cn({nodes:t,width:e,height:i,panZoom:s,minZoom:n,maxZoom:r},o){if(t.size===0)return Promise.resolve(!0);const a=Ne(t,o),l=le(a),u=Ve(l,e,i,(o==null?void 0:o.minZoom)??n,(o==null?void 0:o.maxZoom)??r,(o==null?void 0:o.padding)??.1);return await s.setViewport(u,{duration:o==null?void 0:o.duration,ease:o==null?void 0:o.ease,interpolate:o==null?void 0:o.interpolate}),Promise.resolve(!0)}function Be({nodeId:t,nextPosition:e,nodeLookup:i,nodeOrigin:s=[0,0],nodeExtent:n,onError:r}){const o=i.get(t),a=o.parentId?i.get(o.parentId):void 0,{x:l,y:u}=a?a.internals.positionAbsolute:{x:0,y:0},f=o.origin??s;let c=o.extent||n;if(o.extent==="parent"&&!o.expandParent)if(!a)r==null||r("005",At.error005());else{const p=a.measured.width,h=a.measured.height;p&&h&&(c=[[l,u],[l+p,u+h]])}else a&&ut(o.extent)&&(c=[[o.extent[0][0]+l,o.extent[0][1]+u],[o.extent[1][0]+l,o.extent[1][1]+u]]);const d=ut(c)?ot(e,c,o.measured):e;return(o.measured.width===void 0||o.measured.height===void 0)&&(r==null||r("015",At.error015())),{position:{x:d.x-l+(o.measured.width??0)*f[0],y:d.y-u+(o.measured.height??0)*f[1]},positionAbsolute:d}}async function vn({nodesToRemove:t=[],edgesToRemove:e=[],nodes:i,edges:s,onBeforeDelete:n}){const r=new Set(t.map(d=>d.id)),o=[];for(const d of i){if(d.deletable===!1)continue;const p=r.has(d.id),h=!p&&d.parentId&&o.find(g=>g.id===d.parentId);(p||h)&&o.push(d)}const a=new Set(e.map(d=>d.id)),l=s.filter(d=>d.deletable!==!1),f=Ae(o,l);for(const d of l)a.has(d.id)&&!f.find(h=>h.id===d.id)&&f.push(d);if(!n)return{edges:f,nodes:o};const c=await n({nodes:o,edges:f});return typeof c=="boolean"?c?{edges:f,nodes:o}:{edges:[],nodes:[]}:c}const lt=(t,e=0,i=1)=>Math.min(Math.max(t,e),i),ot=(t={x:0,y:0},e,i)=>({x:lt(t.x,e[0][0],e[1][0]-((i==null?void 0:i.width)??0)),y:lt(t.y,e[0][1],e[1][1]-((i==null?void 0:i.height)??0))});function ue(t,e,i){const{width:s,height:n}=rt(i),{x:r,y:o}=i.internals.positionAbsolute;return ot(t,[[r,o],[r+s,o+n]],e)}const kt=(t,e,i)=>t<e?lt(Math.abs(t-e),1,e)/e:t>i?-lt(Math.abs(t-i),1,e)/e:0,fe=(t,e,i=15,s=40)=>{const n=kt(t.x,s,e.width-s)*i,r=kt(t.y,s,e.height-s)*i;return[n,r]},Mt=(t,e)=>({x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x2:Math.max(t.x2,e.x2),y2:Math.max(t.y2,e.y2)}),Nt=({x:t,y:e,width:i,height:s})=>({x:t,y:e,x2:t+i,y2:e+s}),bt=({x:t,y:e,x2:i,y2:s})=>({x:t,y:e,width:i-t,height:s-e}),Et=(t,e=[0,0])=>{var n,r;const{x:i,y:s}=Yt(t)?t.internals.positionAbsolute:yt(t,e);return{x:i,y:s,width:((n=t.measured)==null?void 0:n.width)??t.width??t.initialWidth??0,height:((r=t.measured)==null?void 0:r.height)??t.height??t.initialHeight??0}},mt=(t,e=[0,0])=>{var n,r;const{x:i,y:s}=Yt(t)?t.internals.positionAbsolute:yt(t,e);return{x:i,y:s,x2:i+(((n=t.measured)==null?void 0:n.width)??t.width??t.initialWidth??0),y2:s+(((r=t.measured)==null?void 0:r.height)??t.height??t.initialHeight??0)}},Ye=(t,e)=>bt(Mt(Nt(t),Nt(e))),zt=(t,e)=>{const i=Math.max(0,Math.min(t.x+t.width,e.x+e.width)-Math.max(t.x,e.x)),s=Math.max(0,Math.min(t.y+t.height,e.y+e.height)-Math.max(t.y,e.y));return Math.ceil(i*s)},Pn=t=>st(t.width)&&st(t.height)&&st(t.x)&&st(t.y),st=t=>!isNaN(t)&&isFinite(t),An=(t,e)=>{},Ht=(t,e=[1,1])=>({x:e[0]*Math.round(t.x/e[0]),y:e[1]*Math.round(t.y/e[1])}),Xt=({x:t,y:e},[i,s,n],r=!1,o=[1,1])=>{const a={x:(t-i)/n,y:(e-s)/n};return r?Ht(a,o):a},Bt=({x:t,y:e},[i,s,n])=>({x:t*n+i,y:e*n+s});function at(t,e){if(typeof t=="number")return Math.floor((e-e/(1+t))*.5);if(typeof t=="string"&&t.endsWith("px")){const i=parseFloat(t);if(!Number.isNaN(i))return Math.floor(i)}if(typeof t=="string"&&t.endsWith("%")){const i=parseFloat(t);if(!Number.isNaN(i))return Math.floor(e*i*.01)}return console.error(`[React Flow] The padding value "${t}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function ze(t,e,i){if(typeof t=="string"||typeof t=="number"){const s=at(t,i),n=at(t,e);return{top:s,right:n,bottom:s,left:n,x:n*2,y:s*2}}if(typeof t=="object"){const s=at(t.top??t.y??0,i),n=at(t.bottom??t.y??0,i),r=at(t.left??t.x??0,e),o=at(t.right??t.x??0,e);return{top:s,right:o,bottom:n,left:r,x:r+o,y:s+n}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function Xe(t,e,i,s,n,r){const{x:o,y:a}=Bt(t,[e,i,s]),{x:l,y:u}=Bt({x:t.x+t.width,y:t.y+t.height},[e,i,s]),f=n-l,c=r-u;return{left:Math.floor(o),top:Math.floor(a),right:Math.floor(f),bottom:Math.floor(c)}}const Ve=(t,e,i,s,n,r)=>{const o=ze(r,e,i),a=(e-o.x)/t.width,l=(i-o.y)/t.height,u=Math.min(a,l),f=lt(u,s,n),c=t.x+t.width/2,d=t.y+t.height/2,p=e/2-c*f,h=i/2-d*f,g=Xe(t,p,h,f,e,i),b={left:Math.min(g.left-o.left,0),top:Math.min(g.top-o.top,0),right:Math.min(g.right-o.right,0),bottom:Math.min(g.bottom-o.bottom,0)};return{x:p-b.left+b.right,y:h-b.top+b.bottom,zoom:f}},Vt=()=>{var t;return typeof navigator<"u"&&((t=navigator==null?void 0:navigator.userAgent)==null?void 0:t.indexOf("Mac"))>=0};function ut(t){return t!=null&&t!=="parent"}function rt(t){var e,i;return{width:((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth??0,height:((i=t.measured)==null?void 0:i.height)??t.height??t.initialHeight??0}}function Nn(t){var e,i;return(((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth)!==void 0&&(((i=t.measured)==null?void 0:i.height)??t.height??t.initialHeight)!==void 0}function Bn(t,e={width:0,height:0},i,s,n){const r={...t},o=s.get(i);if(o){const a=o.origin||n;r.x+=o.internals.positionAbsolute.x-(e.width??0)*a[0],r.y+=o.internals.positionAbsolute.y-(e.height??0)*a[1]}return r}function Yn(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function zn(){let t,e;return{promise:new Promise((s,n)=>{t=s,e=n}),resolve:t,reject:e}}function Xn(t){return{...ve,...t||{}}}function ht(t,{snapGrid:e=[0,0],snapToGrid:i=!1,transform:s,containerBounds:n}){const{x:r,y:o}=tt(t),a=Xt({x:r-((n==null?void 0:n.left)??0),y:o-((n==null?void 0:n.top)??0)},s),{x:l,y:u}=i?Ht(a,e):a;return{xSnapped:l,ySnapped:u,...a}}const de=t=>({width:t.offsetWidth,height:t.offsetHeight}),De=t=>{var e;return((e=t==null?void 0:t.getRootNode)==null?void 0:e.call(t))||(window==null?void 0:window.document)},Oe=["INPUT","SELECT","TEXTAREA"];function Vn(t){var s,n;const e=((n=(s=t.composedPath)==null?void 0:s.call(t))==null?void 0:n[0])||t.target;return(e==null?void 0:e.nodeType)!==1?!1:Oe.includes(e.nodeName)||e.hasAttribute("contenteditable")||!!e.closest(".nokey")}const We=t=>"clientX"in t,tt=(t,e)=>{var r,o;const i=We(t),s=i?t.clientX:(r=t.touches)==null?void 0:r[0].clientX,n=i?t.clientY:(o=t.touches)==null?void 0:o[0].clientY;return{x:s-((e==null?void 0:e.left)??0),y:n-((e==null?void 0:e.top)??0)}},Kt=(t,e,i,s,n)=>{const r=e.querySelectorAll(`.${t}`);return!r||!r.length?null:Array.from(r).map(o=>{const a=o.getBoundingClientRect();return{id:o.getAttribute("data-handleid"),type:t,nodeId:n,position:o.getAttribute("data-handlepos"),x:(a.left-i.left)/s,y:(a.top-i.top)/s,...de(o)}})};function _e({sourceX:t,sourceY:e,targetX:i,targetY:s,sourceControlX:n,sourceControlY:r,targetControlX:o,targetControlY:a}){const l=t*.125+n*.375+o*.375+i*.125,u=e*.125+r*.375+a*.375+s*.125,f=Math.abs(l-t),c=Math.abs(u-e);return[l,u,f,c]}function xt(t,e){return t>=0?.5*t:e*25*Math.sqrt(-t)}function Ut({pos:t,x1:e,y1:i,x2:s,y2:n,c:r}){switch(t){case Y.Left:return[e-xt(e-s,r),i];case Y.Right:return[e+xt(s-e,r),i];case Y.Top:return[e,i-xt(i-n,r)];case Y.Bottom:return[e,i+xt(n-i,r)]}}function Dn({sourceX:t,sourceY:e,sourcePosition:i=Y.Bottom,targetX:s,targetY:n,targetPosition:r=Y.Top,curvature:o=.25}){const[a,l]=Ut({pos:i,x1:t,y1:e,x2:s,y2:n,c:o}),[u,f]=Ut({pos:r,x1:s,y1:n,x2:t,y2:e,c:o}),[c,d,p,h]=_e({sourceX:t,sourceY:e,targetX:s,targetY:n,sourceControlX:a,sourceControlY:l,targetControlX:u,targetControlY:f});return[`M${t},${e} C${a},${l} ${u},${f} ${s},${n}`,c,d,p,h]}function he({sourceX:t,sourceY:e,targetX:i,targetY:s}){const n=Math.abs(i-t)/2,r=i<t?i+n:i-n,o=Math.abs(s-e)/2,a=s<e?s+o:s-o;return[r,a,n,o]}function On({sourceNode:t,targetNode:e,selected:i=!1,zIndex:s=0,elevateOnSelect:n=!1,zIndexMode:r="basic"}){if(r==="manual")return s;const o=n&&i?s+1e3:s,a=Math.max(t.parentId||n&&t.selected?t.internals.z:0,e.parentId||n&&e.selected?e.internals.z:0);return o+a}function Wn({sourceNode:t,targetNode:e,width:i,height:s,transform:n}){const r=Mt(mt(t),mt(e));r.x===r.x2&&(r.x2+=1),r.y===r.y2&&(r.y2+=1);const o={x:-n[0]/n[2],y:-n[1]/n[2],width:i/n[2],height:s/n[2]};return zt(o,bt(r))>0}const Le=({source:t,sourceHandle:e,target:i,targetHandle:s})=>`xy-edge__${t}${e||""}-${i}${s||""}`,Fe=(t,e)=>e.some(i=>i.source===t.source&&i.target===t.target&&(i.sourceHandle===t.sourceHandle||!i.sourceHandle&&!t.sourceHandle)&&(i.targetHandle===t.targetHandle||!i.targetHandle&&!t.targetHandle)),_n=(t,e,i={})=>{if(!t.source||!t.target)return e;const s=i.getEdgeId||Le;let n;return Pe(t)?n={...t}:n={...t,id:s(t)},Fe(n,e)?e:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,e.concat(n))};function Ln({sourceX:t,sourceY:e,targetX:i,targetY:s}){const[n,r,o,a]=he({sourceX:t,sourceY:e,targetX:i,targetY:s});return[`M ${t},${e}L ${i},${s}`,n,r,o,a]}const jt={[Y.Left]:{x:-1,y:0},[Y.Right]:{x:1,y:0},[Y.Top]:{x:0,y:-1},[Y.Bottom]:{x:0,y:1}},Re=({source:t,sourcePosition:e=Y.Bottom,target:i})=>e===Y.Left||e===Y.Right?t.x<i.x?{x:1,y:0}:{x:-1,y:0}:t.y<i.y?{x:0,y:1}:{x:0,y:-1},Qt=(t,e)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));function Ge({source:t,sourcePosition:e=Y.Bottom,target:i,targetPosition:s=Y.Top,center:n,offset:r,stepPosition:o}){const a=jt[e],l=jt[s],u={x:t.x+a.x*r,y:t.y+a.y*r},f={x:i.x+l.x*r,y:i.y+l.y*r},c=Re({source:u,sourcePosition:e,target:f}),d=c.x!==0?"x":"y",p=c[d];let h=[],g,b;const m={x:0,y:0},v={x:0,y:0},[,,x,H]=he({sourceX:t.x,sourceY:t.y,targetX:i.x,targetY:i.y});if(a[d]*l[d]===-1){d==="x"?(g=n.x??u.x+(f.x-u.x)*o,b=n.y??(u.y+f.y)/2):(g=n.x??(u.x+f.x)/2,b=n.y??u.y+(f.y-u.y)*o);const A=[{x:g,y:u.y},{x:g,y:f.y}],$=[{x:u.x,y:b},{x:f.x,y:b}];a[d]===p?h=d==="x"?A:$:h=d==="x"?$:A}else{const A=[{x:u.x,y:f.y}],$=[{x:f.x,y:u.y}];if(d==="x"?h=a.x===p?$:A:h=a.y===p?A:$,e===s){const y=Math.abs(t[d]-i[d]);if(y<=r){const w=Math.min(r-1,r-y);a[d]===p?m[d]=(u[d]>t[d]?-1:1)*w:v[d]=(f[d]>i[d]?-1:1)*w}}if(e!==s){const y=d==="x"?"y":"x",w=a[d]===l[y],C=u[y]>f[y],E=u[y]<f[y];(a[d]===1&&(!w&&C||w&&E)||a[d]!==1&&(!w&&E||w&&C))&&(h=d==="x"?A:$)}const I={x:u.x+m.x,y:u.y+m.y},T={x:f.x+v.x,y:f.y+v.y},S=Math.max(Math.abs(I.x-h[0].x),Math.abs(T.x-h[0].x)),M=Math.max(Math.abs(I.y-h[0].y),Math.abs(T.y-h[0].y));S>=M?(g=(I.x+T.x)/2,b=h[0].y):(g=h[0].x,b=(I.y+T.y)/2)}return[[t,{x:u.x+m.x,y:u.y+m.y},...h,{x:f.x+v.x,y:f.y+v.y},i],g,b,x,H]}function Se(t,e,i,s){const n=Math.min(Qt(t,e)/2,Qt(e,i)/2,s),{x:r,y:o}=e;if(t.x===r&&r===i.x||t.y===o&&o===i.y)return`L${r} ${o}`;if(t.y===o){const u=t.x<i.x?-1:1,f=t.y<i.y?1:-1;return`L ${r+n*u},${o}Q ${r},${o} ${r},${o+n*f}`}const a=t.x<i.x?1:-1,l=t.y<i.y?-1:1;return`L ${r},${o+n*l}Q ${r},${o} ${r+n*a},${o}`}function Fn({sourceX:t,sourceY:e,sourcePosition:i=Y.Bottom,targetX:s,targetY:n,targetPosition:r=Y.Top,borderRadius:o=5,centerX:a,centerY:l,offset:u=20,stepPosition:f=.5}){const[c,d,p,h,g]=Ge({source:{x:t,y:e},sourcePosition:i,target:{x:s,y:n},targetPosition:r,center:{x:a,y:l},offset:u,stepPosition:f});return[c.reduce((m,v,x)=>{let H="";return x>0&&x<c.length-1?H=Se(c[x-1],v,c[x+1],o):H=`${x===0?"M":"L"}${v.x} ${v.y}`,m+=H,m},""),d,p,h,g]}function Jt(t){var e;return t&&!!(t.internals.handleBounds||(e=t.handles)!=null&&e.length)&&!!(t.measured.width||t.width||t.initialWidth)}function Rn(t){var c;const{sourceNode:e,targetNode:i}=t;if(!Jt(e)||!Jt(i))return null;const s=e.internals.handleBounds||Zt(e.handles),n=i.internals.handleBounds||Zt(i.handles),r=te((s==null?void 0:s.source)??[],t.sourceHandle),o=te(t.connectionMode===pt.Strict?(n==null?void 0:n.target)??[]:((n==null?void 0:n.target)??[]).concat((n==null?void 0:n.source)??[]),t.targetHandle);if(!r||!o)return(c=t.onError)==null||c.call(t,"008",At.error008(r?"target":"source",{id:t.id,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle})),null;const a=(r==null?void 0:r.position)||Y.Bottom,l=(o==null?void 0:o.position)||Y.Top,u=ft(e,r,a),f=ft(i,o,l);return{sourceX:u.x,sourceY:u.y,targetX:f.x,targetY:f.y,sourcePosition:a,targetPosition:l}}function Zt(t){if(!t)return null;const e=[],i=[];for(const s of t)s.width=s.width??1,s.height=s.height??1,s.type==="source"?e.push(s):s.type==="target"&&i.push(s);return{source:e,target:i}}function ft(t,e,i=Y.Left,s=!1){const n=((e==null?void 0:e.x)??0)+t.internals.positionAbsolute.x,r=((e==null?void 0:e.y)??0)+t.internals.positionAbsolute.y,{width:o,height:a}=e??rt(t);if(s)return{x:n+o/2,y:r+a/2};switch((e==null?void 0:e.position)??i){case Y.Top:return{x:n+o/2,y:r};case Y.Right:return{x:n+o,y:r+a/2};case Y.Bottom:return{x:n+o/2,y:r+a};case Y.Left:return{x:n,y:r+a/2}}}function te(t,e){return t&&(e?t.find(i=>i.id===e):t[0])||null}function qe(t,e){return t?typeof t=="string"?t:`${e?`${e}__`:""}${Object.keys(t).sort().map(s=>`${s}=${t[s]}`).join("&")}`:""}function Gn(t,{id:e,defaultColor:i,defaultMarkerStart:s,defaultMarkerEnd:n}){const r=new Set;return t.reduce((o,a)=>([a.markerStart||s,a.markerEnd||n].forEach(l=>{if(l&&typeof l=="object"){const u=qe(l,e);r.has(u)||(o.push({id:u,color:l.color||i,...l}),r.add(u))}}),o),[]).sort((o,a)=>o.id.localeCompare(a.id))}const ye=1e3,ke=10,Dt={nodeOrigin:[0,0],nodeExtent:Ce,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},Ke={...Dt,checkEquality:!0};function Ot(t,e){const i={...t};for(const s in e)e[s]!==void 0&&(i[s]=e[s]);return i}function Sn(t,e,i){const s=Ot(Dt,i);for(const n of t.values())if(n.parentId)_t(n,t,e,s);else{const r=yt(n,s.nodeOrigin),o=ut(n.extent)?n.extent:s.nodeExtent,a=ot(r,o,rt(n));n.internals.positionAbsolute=a}}function Ue(t,e){if(!t.handles)return t.measured?e==null?void 0:e.internals.handleBounds:void 0;const i=[],s=[];for(const n of t.handles){const r={id:n.id,width:n.width??1,height:n.height??1,nodeId:t.id,x:n.x,y:n.y,position:n.position,type:n.type};n.type==="source"?i.push(r):n.type==="target"&&s.push(r)}return{source:i,target:s}}function Wt(t){return t==="manual"}function qn(t,e,i,s={}){var u,f;const n=Ot(Ke,s),r={i:0},o=new Map(e),a=n!=null&&n.elevateNodesOnSelect&&!Wt(n.zIndexMode)?ye:0;let l=t.length>0;e.clear(),i.clear();for(const c of t){let d=o.get(c.id);if(n.checkEquality&&c===(d==null?void 0:d.internals.userNode))e.set(c.id,d);else{const p=yt(c,n.nodeOrigin),h=ut(c.extent)?c.extent:n.nodeExtent,g=ot(p,h,rt(c));d={...n.defaults,...c,measured:{width:(u=c.measured)==null?void 0:u.width,height:(f=c.measured)==null?void 0:f.height},internals:{positionAbsolute:g,handleBounds:Ue(c,d),z:xe(c,a,n.zIndexMode),userNode:c}},e.set(c.id,d)}(d.measured===void 0||d.measured.width===void 0||d.measured.height===void 0)&&!d.hidden&&(l=!1),c.parentId&&_t(d,e,i,s,r)}return l}function je(t,e){if(!t.parentId)return;const i=e.get(t.parentId);i?i.set(t.id,t):e.set(t.parentId,new Map([[t.id,t]]))}function _t(t,e,i,s,n){const{elevateNodesOnSelect:r,nodeOrigin:o,nodeExtent:a,zIndexMode:l}=Ot(Dt,s),u=t.parentId,f=e.get(u);if(!f){console.warn(`Parent node ${u} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}je(t,i),n&&!f.parentId&&f.internals.rootParentIndex===void 0&&l==="auto"&&(f.internals.rootParentIndex=++n.i,f.internals.z=f.internals.z+n.i*ke),n&&f.internals.rootParentIndex!==void 0&&(n.i=f.internals.rootParentIndex);const c=r&&!Wt(l)?ye:0,{x:d,y:p,z:h}=Qe(t,f,o,a,c,l),{positionAbsolute:g}=t.internals,b=d!==g.x||p!==g.y;(b||h!==t.internals.z)&&e.set(t.id,{...t,internals:{...t.internals,positionAbsolute:b?{x:d,y:p}:g,z:h}})}function xe(t,e,i){const s=st(t.zIndex)?t.zIndex:0;return Wt(i)?s:s+(t.selected?e:0)}function Qe(t,e,i,s,n,r){const{x:o,y:a}=e.internals.positionAbsolute,l=rt(t),u=yt(t,i),f=ut(t.extent)?ot(u,t.extent,l):u;let c=ot({x:o+f.x,y:a+f.y},s,l);t.extent==="parent"&&(c=ue(c,l,e));const d=xe(t,n,r),p=e.internals.z??0;return{x:c.x,y:c.y,z:p>=d?p+1:d}}function Je(t,e,i,s=[0,0]){var o;const n=[],r=new Map;for(const a of t){const l=e.get(a.parentId);if(!l)continue;const u=((o=r.get(a.parentId))==null?void 0:o.expandedRect)??Et(l),f=Ye(u,a.rect);r.set(a.parentId,{expandedRect:f,parent:l})}return r.size>0&&r.forEach(({expandedRect:a,parent:l},u)=>{var x;const f=l.internals.positionAbsolute,c=rt(l),d=l.origin??s,p=a.x<f.x?Math.round(Math.abs(f.x-a.x)):0,h=a.y<f.y?Math.round(Math.abs(f.y-a.y)):0,g=Math.max(c.width,Math.round(a.width)),b=Math.max(c.height,Math.round(a.height)),m=(g-c.width)*d[0],v=(b-c.height)*d[1];(p>0||h>0||m||v)&&(n.push({id:u,type:"position",position:{x:l.position.x-p+m,y:l.position.y-h+v}}),(x=i.get(u))==null||x.forEach(H=>{t.some(X=>X.id===H.id)||n.push({id:H.id,type:"position",position:{x:H.position.x+p,y:H.position.y+h}})})),(c.width<a.width||c.height<a.height||p||h)&&n.push({id:u,type:"dimensions",setAttributes:!0,dimensions:{width:g+(p?d[0]*p-m:0),height:b+(h?d[1]*h-v:0)}})}),n}function kn(t,e,i,s,n,r,o){const a=s==null?void 0:s.querySelector(".xyflow__viewport");let l=!1;if(!a)return{changes:[],updatedInternals:l};const u=[],f=window.getComputedStyle(a),{m22:c}=new window.DOMMatrixReadOnly(f.transform),d=[];for(const p of t.values()){const h=e.get(p.id);if(!h)continue;if(h.hidden){e.set(h.id,{...h,internals:{...h.internals,handleBounds:void 0}}),l=!0;continue}const g=de(p.nodeElement),b=h.measured.width!==g.width||h.measured.height!==g.height;if(!!(g.width&&g.height&&(b||!h.internals.handleBounds||p.force))){const v=p.nodeElement.getBoundingClientRect(),x=ut(h.extent)?h.extent:r;let{positionAbsolute:H}=h.internals;h.parentId&&h.extent==="parent"?H=ue(H,g,e.get(h.parentId)):x&&(H=ot(H,x,g));const X={...h,measured:g,internals:{...h.internals,positionAbsolute:H,handleBounds:{source:Kt("source",p.nodeElement,v,c,h.id),target:Kt("target",p.nodeElement,v,c,h.id)}}};e.set(h.id,X),h.parentId&&_t(X,e,i,{nodeOrigin:n,zIndexMode:o}),l=!0,b&&(u.push({id:h.id,type:"dimensions",dimensions:g}),h.expandParent&&h.parentId&&d.push({id:h.id,parentId:h.parentId,rect:Et(X,n)}))}}if(d.length>0){const p=Je(d,e,i,n);u.push(...p)}return{changes:u,updatedInternals:l}}async function Kn({delta:t,panZoom:e,transform:i,translateExtent:s,width:n,height:r}){if(!e||!t.x&&!t.y)return Promise.resolve(!1);const o=await e.setViewportConstrained({x:i[0]+t.x,y:i[1]+t.y,zoom:i[2]},[[0,0],[n,r]],s),a=!!o&&(o.x!==i[0]||o.y!==i[1]||o.k!==i[2]);return Promise.resolve(a)}function ee(t,e,i,s,n,r){let o=n;const a=s.get(o)||new Map;s.set(o,a.set(i,e)),o=`${n}-${t}`;const l=s.get(o)||new Map;if(s.set(o,l.set(i,e)),r){o=`${n}-${t}-${r}`;const u=s.get(o)||new Map;s.set(o,u.set(i,e))}}function Un(t,e,i){t.clear(),e.clear();for(const s of i){const{source:n,target:r,sourceHandle:o=null,targetHandle:a=null}=s,l={edgeId:s.id,source:n,target:r,sourceHandle:o,targetHandle:a},u=`${n}-${o}--${r}-${a}`,f=`${r}-${a}--${n}-${o}`;ee("source",l,f,t,n,o),ee("target",l,u,t,r,a),e.set(s.id,s)}}function ge(t,e){if(!t.parentId)return!1;const i=e.get(t.parentId);return i?i.selected?!0:ge(i,e):!1}function ne(t,e,i){var n;let s=t;do{if((n=s==null?void 0:s.matches)!=null&&n.call(s,e))return!0;if(s===i)return!1;s=s==null?void 0:s.parentElement}while(s);return!1}function Ze(t,e,i,s){const n=new Map;for(const[r,o]of t)if((o.selected||o.id===s)&&(!o.parentId||!ge(o,t))&&(o.draggable||e&&typeof o.draggable>"u")){const a=t.get(r);a&&n.set(r,{id:r,position:a.position||{x:0,y:0},distance:{x:i.x-a.internals.positionAbsolute.x,y:i.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return n}function Ct({nodeId:t,dragItems:e,nodeLookup:i,dragging:s=!0}){var o,a,l;const n=[];for(const[u,f]of e){const c=(o=i.get(u))==null?void 0:o.internals.userNode;c&&n.push({...c,position:f.position,dragging:s})}if(!t)return[n[0],n];const r=(a=i.get(t))==null?void 0:a.internals.userNode;return[r?{...r,position:((l=e.get(t))==null?void 0:l.position)||r.position,dragging:s}:n[0],n]}function tn({dragItems:t,snapGrid:e,x:i,y:s}){const n=t.values().next().value;if(!n)return null;const r={x:i-n.distance.x,y:s-n.distance.y},o=Ht(r,e);return{x:o.x-r.x,y:o.y-r.y}}function jn({onNodeMouseDown:t,getStoreItems:e,onDragStart:i,onDrag:s,onDragStop:n}){let r={x:null,y:null},o=0,a=new Map,l=!1,u={x:0,y:0},f=null,c=!1,d=null,p=!1,h=!1,g=null;function b({noDragClassName:v,handleSelector:x,domNode:H,isSelectable:X,nodeId:A,nodeClickDistance:$=0}){d=wt(H);function I({x:y,y:w}){const{nodeLookup:C,nodeExtent:E,snapGrid:z,snapToGrid:V,nodeOrigin:N,onNodeDrag:P,onSelectionDrag:O,onError:D,updateNodePositions:B}=e();r={x:y,y:w};let L=!1;const F=a.size>1,q=F&&E?Nt(le(a)):null,U=F&&V?tn({dragItems:a,snapGrid:z,x:y,y:w}):null;for(const[R,W]of a){if(!C.has(R))continue;let k={x:y-W.distance.x,y:w-W.distance.y};V&&(k=U?{x:Math.round(k.x+U.x),y:Math.round(k.y+U.y)}:Ht(k,z));let K=null;if(F&&E&&!W.extent&&q){const{positionAbsolute:_}=W.internals,Q=_.x-q.x+E[0][0],Z=_.x+W.measured.width-q.x2+E[1][0],J=_.y-q.y+E[0][1],et=_.y+W.measured.height-q.y2+E[1][1];K=[[Q,J],[Z,et]]}const{position:G,positionAbsolute:j}=Be({nodeId:R,nextPosition:k,nodeLookup:C,nodeExtent:K||E,nodeOrigin:N,onError:D});L=L||W.position.x!==G.x||W.position.y!==G.y,W.position=G,W.internals.positionAbsolute=j}if(h=h||L,!!L&&(B(a,!0),g&&(s||P||!A&&O))){const[R,W]=Ct({nodeId:A,dragItems:a,nodeLookup:C});s==null||s(g,a,R,W),P==null||P(g,R,W),A||O==null||O(g,W)}}async function T(){if(!f)return;const{transform:y,panBy:w,autoPanSpeed:C,autoPanOnNodeDrag:E}=e();if(!E){l=!1,cancelAnimationFrame(o);return}const[z,V]=fe(u,f,C);(z!==0||V!==0)&&(r.x=(r.x??0)-z/y[2],r.y=(r.y??0)-V/y[2],await w({x:z,y:V})&&I(r)),o=requestAnimationFrame(T)}function S(y){var F;const{nodeLookup:w,multiSelectionActive:C,nodesDraggable:E,transform:z,snapGrid:V,snapToGrid:N,selectNodesOnDrag:P,onNodeDragStart:O,onSelectionDragStart:D,unselectNodesAndEdges:B}=e();c=!0,(!P||!X)&&!C&&A&&((F=w.get(A))!=null&&F.selected||B()),X&&P&&A&&(t==null||t(A));const L=ht(y.sourceEvent,{transform:z,snapGrid:V,snapToGrid:N,containerBounds:f});if(r=L,a=Ze(w,E,L,A),a.size>0&&(i||O||!A&&D)){const[q,U]=Ct({nodeId:A,dragItems:a,nodeLookup:w});i==null||i(y.sourceEvent,a,q,U),O==null||O(y.sourceEvent,q,U),A||D==null||D(y.sourceEvent,U)}}const M=ce().clickDistance($).on("start",y=>{const{domNode:w,nodeDragThreshold:C,transform:E,snapGrid:z,snapToGrid:V}=e();f=(w==null?void 0:w.getBoundingClientRect())||null,p=!1,h=!1,g=y.sourceEvent,C===0&&S(y),r=ht(y.sourceEvent,{transform:E,snapGrid:z,snapToGrid:V,containerBounds:f}),u=tt(y.sourceEvent,f)}).on("drag",y=>{const{autoPanOnNodeDrag:w,transform:C,snapGrid:E,snapToGrid:z,nodeDragThreshold:V,nodeLookup:N}=e(),P=ht(y.sourceEvent,{transform:C,snapGrid:E,snapToGrid:z,containerBounds:f});if(g=y.sourceEvent,(y.sourceEvent.type==="touchmove"&&y.sourceEvent.touches.length>1||A&&!N.has(A))&&(p=!0),!p){if(!l&&w&&c&&(l=!0,T()),!c){const O=tt(y.sourceEvent,f),D=O.x-u.x,B=O.y-u.y;Math.sqrt(D*D+B*B)>V&&S(y)}(r.x!==P.xSnapped||r.y!==P.ySnapped)&&a&&c&&(u=tt(y.sourceEvent,f),I(P))}}).on("end",y=>{if(!(!c||p)&&(l=!1,c=!1,cancelAnimationFrame(o),a.size>0)){const{nodeLookup:w,updateNodePositions:C,onNodeDragStop:E,onSelectionDragStop:z}=e();if(h&&(C(a,!1),h=!1),n||E||!A&&z){const[V,N]=Ct({nodeId:A,dragItems:a,nodeLookup:w,dragging:!1});n==null||n(y.sourceEvent,a,V,N),E==null||E(y.sourceEvent,V,N),A||z==null||z(y.sourceEvent,N)}}}).filter(y=>{const w=y.target;return!y.button&&(!v||!ne(w,`.${v}`,H))&&(!x||ne(w,x,H))});d.call(M)}function m(){d==null||d.on(".drag",null)}return{update:b,destroy:m}}function en(t,e,i){const s=[],n={x:t.x-i,y:t.y-i,width:i*2,height:i*2};for(const r of e.values())zt(n,Et(r))>0&&s.push(r);return s}const nn=250;function sn(t,e,i,s){var a,l;let n=[],r=1/0;const o=en(t,i,e+nn);for(const u of o){const f=[...((a=u.internals.handleBounds)==null?void 0:a.source)??[],...((l=u.internals.handleBounds)==null?void 0:l.target)??[]];for(const c of f){if(s.nodeId===c.nodeId&&s.type===c.type&&s.id===c.id)continue;const{x:d,y:p}=ft(u,c,c.position,!0),h=Math.sqrt(Math.pow(d-t.x,2)+Math.pow(p-t.y,2));h>e||(h<r?(n=[{...c,x:d,y:p}],r=h):h===r&&n.push({...c,x:d,y:p}))}}if(!n.length)return null;if(n.length>1){const u=s.type==="source"?"target":"source";return n.find(f=>f.type===u)??n[0]}return n[0]}function pe(t,e,i,s,n,r=!1){var u,f,c;const o=s.get(t);if(!o)return null;const a=n==="strict"?(u=o.internals.handleBounds)==null?void 0:u[e]:[...((f=o.internals.handleBounds)==null?void 0:f.source)??[],...((c=o.internals.handleBounds)==null?void 0:c.target)??[]],l=(i?a==null?void 0:a.find(d=>d.id===i):a==null?void 0:a[0])??null;return l&&r?{...l,...ft(o,l,l.position,!0)}:l}function me(t,e){return t||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function on(t,e){let i=null;return e?i=!0:t&&!e&&(i=!1),i}const we=()=>!0;function rn(t,{connectionMode:e,connectionRadius:i,handleId:s,nodeId:n,edgeUpdaterType:r,isTarget:o,domNode:a,nodeLookup:l,lib:u,autoPanOnConnect:f,flowId:c,panBy:d,cancelConnection:p,onConnectStart:h,onConnect:g,onConnectEnd:b,isValidConnection:m=we,onReconnectEnd:v,updateConnection:x,getTransform:H,getFromHandle:X,autoPanSpeed:A,dragThreshold:$=1,handleDomNode:I}){const T=De(t.target);let S=0,M;const{x:y,y:w}=tt(t),C=me(r,I),E=a==null?void 0:a.getBoundingClientRect();let z=!1;if(!E||!C)return;const V=pe(n,C,s,l,e);if(!V)return;let N=tt(t,E),P=!1,O=null,D=!1,B=null;function L(){if(!f||!E)return;const[G,j]=fe(N,E,A);d({x:G,y:j}),S=requestAnimationFrame(L)}const F={...V,nodeId:n,type:C,position:V.position},q=l.get(n);let R={inProgress:!0,isValid:null,from:ft(q,F,Y.Left,!0),fromHandle:F,fromPosition:F.position,fromNode:q,to:N,toHandle:null,toPosition:qt[F.position],toNode:null,pointer:N};function W(){z=!0,x(R),h==null||h(t,{nodeId:n,handleId:s,handleType:C})}$===0&&W();function k(G){if(!z){const{x:et,y:Te}=tt(G),Lt=et-y,Ft=Te-w;if(!(Lt*Lt+Ft*Ft>$*$))return;W()}if(!X()||!F){K(G);return}const j=H();N=tt(G,E),M=sn(Xt(N,j,!1,[1,1]),i,l,F),P||(L(),P=!0);const _=Me(G,{handle:M,connectionMode:e,fromNodeId:n,fromHandleId:s,fromType:o?"target":"source",isValidConnection:m,doc:T,lib:u,flowId:c,nodeLookup:l});B=_.handleDomNode,O=_.connection,D=on(!!M,_.isValid);const Q=l.get(n),Z=Q?ft(Q,F,Y.Left,!0):R.from,J={...R,from:Z,isValid:D,to:_.toHandle&&D?Bt({x:_.toHandle.x,y:_.toHandle.y},j):N,toHandle:_.toHandle,toPosition:D&&_.toHandle?_.toHandle.position:qt[F.position],toNode:_.toHandle?l.get(_.toHandle.nodeId):null,pointer:N};x(J),R=J}function K(G){if(!("touches"in G&&G.touches.length>0)){if(z){(M||B)&&O&&D&&(g==null||g(O));const{inProgress:j,..._}=R,Q={..._,toPosition:R.toHandle?R.toPosition:null};b==null||b(G,Q),r&&(v==null||v(G,Q))}p(),cancelAnimationFrame(S),P=!1,D=!1,O=null,B=null,T.removeEventListener("mousemove",k),T.removeEventListener("mouseup",K),T.removeEventListener("touchmove",k),T.removeEventListener("touchend",K)}}T.addEventListener("mousemove",k),T.addEventListener("mouseup",K),T.addEventListener("touchmove",k),T.addEventListener("touchend",K)}function Me(t,{handle:e,connectionMode:i,fromNodeId:s,fromHandleId:n,fromType:r,doc:o,lib:a,flowId:l,isValidConnection:u=we,nodeLookup:f}){const c=r==="target",d=e?o.querySelector(`.${a}-flow__handle[data-id="${l}-${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`):null,{x:p,y:h}=tt(t),g=o.elementFromPoint(p,h),b=g!=null&&g.classList.contains(`${a}-flow__handle`)?g:d,m={handleDomNode:b,isValid:!1,connection:null,toHandle:null};if(b){const v=me(void 0,b),x=b.getAttribute("data-nodeid"),H=b.getAttribute("data-handleid"),X=b.classList.contains("connectable"),A=b.classList.contains("connectableend");if(!x||!v)return m;const $={source:c?x:s,sourceHandle:c?H:n,target:c?s:x,targetHandle:c?n:H};m.connection=$;const T=X&&A&&(i===pt.Strict?c&&v==="source"||!c&&v==="target":x!==s||H!==n);m.isValid=T&&u($),m.toHandle=pe(x,v,H,f,i,!0)}return m}const Qn={onPointerDown:rn,isValid:Me};function Jn({domNode:t,panZoom:e,getTransform:i,getViewScale:s}){const n=wt(t);function r({translateExtent:a,width:l,height:u,zoomStep:f=1,pannable:c=!0,zoomable:d=!0,inversePan:p=!1}){const h=x=>{if(x.sourceEvent.type!=="wheel"||!e)return;const H=i(),X=x.sourceEvent.ctrlKey&&Vt()?10:1,A=-x.sourceEvent.deltaY*(x.sourceEvent.deltaMode===1?.05:x.sourceEvent.deltaMode?1:.002)*f,$=H[2]*Math.pow(2,A*X);e.scaleTo($)};let g=[0,0];const b=x=>{(x.sourceEvent.type==="mousedown"||x.sourceEvent.type==="touchstart")&&(g=[x.sourceEvent.clientX??x.sourceEvent.touches[0].clientX,x.sourceEvent.clientY??x.sourceEvent.touches[0].clientY])},m=x=>{const H=i();if(x.sourceEvent.type!=="mousemove"&&x.sourceEvent.type!=="touchmove"||!e)return;const X=[x.sourceEvent.clientX??x.sourceEvent.touches[0].clientX,x.sourceEvent.clientY??x.sourceEvent.touches[0].clientY],A=[X[0]-g[0],X[1]-g[1]];g=X;const $=s()*Math.max(H[2],Math.log(H[2]))*(p?-1:1),I={x:H[0]-A[0]*$,y:H[1]-A[1]*$},T=[[0,0],[l,u]];e.setViewportConstrained({x:I.x,y:I.y,zoom:H[2]},T,a)},v=ae().on("start",b).on("zoom",c?m:null).on("zoom.wheel",d?h:null);n.call(v,{})}function o(){n.on("zoom",null)}return{update:r,destroy:o,pointer:re}}const Tt=t=>({x:t.x,y:t.y,zoom:t.k}),vt=({x:t,y:e,zoom:i})=>$e.translate(t,e).scale(i),ct=(t,e)=>t.target.closest(`.${e}`),be=(t,e)=>e===2&&Array.isArray(t)&&t.includes(2),an=t=>((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2,Pt=(t,e=0,i=an,s=()=>{})=>{const n=typeof e=="number"&&e>0;return n||s(),n?t.transition().duration(e).ease(i).on("end",s):t},Ee=t=>{const e=t.ctrlKey&&Vt()?10:1;return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*e};function cn({zoomPanValues:t,noWheelClassName:e,d3Selection:i,d3Zoom:s,panOnScrollMode:n,panOnScrollSpeed:r,zoomOnPinch:o,onPanZoomStart:a,onPanZoom:l,onPanZoomEnd:u}){return f=>{if(ct(f,e))return f.ctrlKey&&f.preventDefault(),!1;f.preventDefault(),f.stopImmediatePropagation();const c=i.property("__zoom").k||1;if(f.ctrlKey&&o){const b=re(f),m=Ee(f),v=c*Math.pow(2,m);s.scaleTo(i,v,b,f);return}const d=f.deltaMode===1?20:1;let p=n===dt.Vertical?0:f.deltaX*d,h=n===dt.Horizontal?0:f.deltaY*d;!Vt()&&f.shiftKey&&n!==dt.Vertical&&(p=f.deltaY*d,h=0),s.translateBy(i,-(p/c)*r,-(h/c)*r,{internal:!0});const g=Tt(i.property("__zoom"));clearTimeout(t.panScrollTimeout),t.isPanScrolling?(l==null||l(f,g),t.panScrollTimeout=setTimeout(()=>{u==null||u(f,g),t.isPanScrolling=!1},150)):(t.isPanScrolling=!0,a==null||a(f,g))}}function ln({noWheelClassName:t,preventScrolling:e,d3ZoomHandler:i}){return function(s,n){const r=s.type==="wheel",o=!e&&r&&!s.ctrlKey,a=ct(s,t);if(s.ctrlKey&&r&&a&&s.preventDefault(),o||a)return null;s.preventDefault(),i.call(this,s,n)}}function un({zoomPanValues:t,onDraggingChange:e,onPanZoomStart:i}){return s=>{var r,o,a;if((r=s.sourceEvent)!=null&&r.internal)return;const n=Tt(s.transform);t.mouseButton=((o=s.sourceEvent)==null?void 0:o.button)||0,t.isZoomingOrPanning=!0,t.prevViewport=n,((a=s.sourceEvent)==null?void 0:a.type)==="mousedown"&&e(!0),i&&(i==null||i(s.sourceEvent,n))}}function fn({zoomPanValues:t,panOnDrag:e,onPaneContextMenu:i,onTransformChange:s,onPanZoom:n}){return r=>{var o,a;t.usedRightMouseButton=!!(i&&be(e,t.mouseButton??0)),(o=r.sourceEvent)!=null&&o.sync||s([r.transform.x,r.transform.y,r.transform.k]),n&&!((a=r.sourceEvent)!=null&&a.internal)&&(n==null||n(r.sourceEvent,Tt(r.transform)))}}function dn({zoomPanValues:t,panOnDrag:e,panOnScroll:i,onDraggingChange:s,onPanZoomEnd:n,onPaneContextMenu:r}){return o=>{var a;if(!((a=o.sourceEvent)!=null&&a.internal)&&(t.isZoomingOrPanning=!1,r&&be(e,t.mouseButton??0)&&!t.usedRightMouseButton&&o.sourceEvent&&r(o.sourceEvent),t.usedRightMouseButton=!1,s(!1),n)){const l=Tt(o.transform);t.prevViewport=l,clearTimeout(t.timerId),t.timerId=setTimeout(()=>{n==null||n(o.sourceEvent,l)},i?150:0)}}}function hn({zoomActivationKeyPressed:t,zoomOnScroll:e,zoomOnPinch:i,panOnDrag:s,panOnScroll:n,zoomOnDoubleClick:r,userSelectionActive:o,noWheelClassName:a,noPanClassName:l,lib:u,connectionInProgress:f}){return c=>{var b;const d=t||e,p=i&&c.ctrlKey,h=c.type==="wheel";if(c.button===1&&c.type==="mousedown"&&(ct(c,`${u}-flow__node`)||ct(c,`${u}-flow__edge`)))return!0;if(!s&&!d&&!n&&!r&&!i||o||f&&!h||ct(c,a)&&h||ct(c,l)&&(!h||n&&h&&!t)||!i&&c.ctrlKey&&h)return!1;if(!i&&c.type==="touchstart"&&((b=c.touches)==null?void 0:b.length)>1)return c.preventDefault(),!1;if(!d&&!n&&!p&&h||!s&&(c.type==="mousedown"||c.type==="touchstart")||Array.isArray(s)&&!s.includes(c.button)&&c.type==="mousedown")return!1;const g=Array.isArray(s)&&s.includes(c.button)||!c.button||c.button<=1;return(!c.ctrlKey||h)&&g}}function Zn({domNode:t,minZoom:e,maxZoom:i,translateExtent:s,viewport:n,onPanZoom:r,onPanZoomStart:o,onPanZoomEnd:a,onDraggingChange:l}){const u={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},f=t.getBoundingClientRect(),c=ae().scaleExtent([e,i]).translateExtent(s),d=wt(t).call(c);v({x:n.x,y:n.y,zoom:lt(n.zoom,e,i)},[[0,0],[f.width,f.height]],s);const p=d.on("wheel.zoom"),h=d.on("dblclick.zoom");c.wheelDelta(Ee);function g(M,y){return d?new Promise(w=>{c==null||c.interpolate((y==null?void 0:y.interpolate)==="linear"?It:$t).transform(Pt(d,y==null?void 0:y.duration,y==null?void 0:y.ease,()=>w(!0)),M)}):Promise.resolve(!1)}function b({noWheelClassName:M,noPanClassName:y,onPaneContextMenu:w,userSelectionActive:C,panOnScroll:E,panOnDrag:z,panOnScrollMode:V,panOnScrollSpeed:N,preventScrolling:P,zoomOnPinch:O,zoomOnScroll:D,zoomOnDoubleClick:B,zoomActivationKeyPressed:L,lib:F,onTransformChange:q,connectionInProgress:U,paneClickDistance:R,selectionOnDrag:W}){C&&!u.isZoomingOrPanning&&m();const k=E&&!L&&!C;c.clickDistance(W?1/0:!st(R)||R<0?0:R);const K=k?cn({zoomPanValues:u,noWheelClassName:M,d3Selection:d,d3Zoom:c,panOnScrollMode:V,panOnScrollSpeed:N,zoomOnPinch:O,onPanZoomStart:o,onPanZoom:r,onPanZoomEnd:a}):ln({noWheelClassName:M,preventScrolling:P,d3ZoomHandler:p});if(d.on("wheel.zoom",K,{passive:!1}),!C){const j=un({zoomPanValues:u,onDraggingChange:l,onPanZoomStart:o});c.on("start",j);const _=fn({zoomPanValues:u,panOnDrag:z,onPaneContextMenu:!!w,onPanZoom:r,onTransformChange:q});c.on("zoom",_);const Q=dn({zoomPanValues:u,panOnDrag:z,panOnScroll:E,onPaneContextMenu:w,onPanZoomEnd:a,onDraggingChange:l});c.on("end",Q)}const G=hn({zoomActivationKeyPressed:L,panOnDrag:z,zoomOnScroll:D,panOnScroll:E,zoomOnDoubleClick:B,zoomOnPinch:O,userSelectionActive:C,noPanClassName:y,noWheelClassName:M,lib:F,connectionInProgress:U});c.filter(G),B?d.on("dblclick.zoom",h):d.on("dblclick.zoom",null)}function m(){c.on("zoom",null)}async function v(M,y,w){const C=vt(M),E=c==null?void 0:c.constrain()(C,y,w);return E&&await g(E),new Promise(z=>z(E))}async function x(M,y){const w=vt(M);return await g(w,y),new Promise(C=>C(w))}function H(M){if(d){const y=vt(M),w=d.property("__zoom");(w.k!==M.zoom||w.x!==M.x||w.y!==M.y)&&(c==null||c.transform(d,y,null,{sync:!0}))}}function X(){const M=d?Ie(d.node()):{x:0,y:0,k:1};return{x:M.x,y:M.y,zoom:M.k}}function A(M,y){return d?new Promise(w=>{c==null||c.interpolate((y==null?void 0:y.interpolate)==="linear"?It:$t).scaleTo(Pt(d,y==null?void 0:y.duration,y==null?void 0:y.ease,()=>w(!0)),M)}):Promise.resolve(!1)}function $(M,y){return d?new Promise(w=>{c==null||c.interpolate((y==null?void 0:y.interpolate)==="linear"?It:$t).scaleBy(Pt(d,y==null?void 0:y.duration,y==null?void 0:y.ease,()=>w(!0)),M)}):Promise.resolve(!1)}function I(M){c==null||c.scaleExtent(M)}function T(M){c==null||c.translateExtent(M)}function S(M){const y=!st(M)||M<0?0:M;c==null||c.clickDistance(y)}return{update:b,destroy:m,setViewport:x,setViewportConstrained:v,getViewport:X,scaleTo:A,scaleBy:$,setScaleExtent:I,setTranslateExtent:T,syncViewport:H,setClickDistance:S}}var ie;(function(t){t.Line="line",t.Handle="handle"})(ie||(ie={}));function yn({width:t,prevWidth:e,height:i,prevHeight:s,affectsX:n,affectsY:r}){const o=t-e,a=i-s,l=[o>0?1:o<0?-1:0,a>0?1:a<0?-1:0];return o&&n&&(l[0]=l[0]*-1),a&&r&&(l[1]=l[1]*-1),l}function se(t){const e=t.includes("right")||t.includes("left"),i=t.includes("bottom")||t.includes("top"),s=t.includes("left"),n=t.includes("top");return{isHorizontal:e,isVertical:i,affectsX:s,affectsY:n}}function nt(t,e){return Math.max(0,e-t)}function it(t,e){return Math.max(0,t-e)}function gt(t,e,i){return Math.max(0,e-t,t-i)}function oe(t,e){return t?!e:e}function xn(t,e,i,s,n,r,o,a){let{affectsX:l,affectsY:u}=e;const{isHorizontal:f,isVertical:c}=e,d=f&&c,{xSnapped:p,ySnapped:h}=i,{minWidth:g,maxWidth:b,minHeight:m,maxHeight:v}=s,{x,y:H,width:X,height:A,aspectRatio:$}=t;let I=Math.floor(f?p-t.pointerX:0),T=Math.floor(c?h-t.pointerY:0);const S=X+(l?-I:I),M=A+(u?-T:T),y=-r[0]*X,w=-r[1]*A;let C=gt(S,g,b),E=gt(M,m,v);if(o){let N=0,P=0;l&&I<0?N=nt(x+I+y,o[0][0]):!l&&I>0&&(N=it(x+S+y,o[1][0])),u&&T<0?P=nt(H+T+w,o[0][1]):!u&&T>0&&(P=it(H+M+w,o[1][1])),C=Math.max(C,N),E=Math.max(E,P)}if(a){let N=0,P=0;l&&I>0?N=it(x+I,a[0][0]):!l&&I<0&&(N=nt(x+S,a[1][0])),u&&T>0?P=it(H+T,a[0][1]):!u&&T<0&&(P=nt(H+M,a[1][1])),C=Math.max(C,N),E=Math.max(E,P)}if(n){if(f){const N=gt(S/$,m,v)*$;if(C=Math.max(C,N),o){let P=0;!l&&!u||l&&!u&&d?P=it(H+w+S/$,o[1][1])*$:P=nt(H+w+(l?I:-I)/$,o[0][1])*$,C=Math.max(C,P)}if(a){let P=0;!l&&!u||l&&!u&&d?P=nt(H+S/$,a[1][1])*$:P=it(H+(l?I:-I)/$,a[0][1])*$,C=Math.max(C,P)}}if(c){const N=gt(M*$,g,b)/$;if(E=Math.max(E,N),o){let P=0;!l&&!u||u&&!l&&d?P=it(x+M*$+y,o[1][0])/$:P=nt(x+(u?T:-T)*$+y,o[0][0])/$,E=Math.max(E,P)}if(a){let P=0;!l&&!u||u&&!l&&d?P=nt(x+M*$,a[1][0])/$:P=it(x+(u?T:-T)*$,a[0][0])/$,E=Math.max(E,P)}}}T=T+(T<0?E:-E),I=I+(I<0?C:-C),n&&(d?S>M*$?T=(oe(l,u)?-I:I)/$:I=(oe(l,u)?-T:T)*$:f?(T=I/$,u=l):(I=T*$,l=u));const z=l?x+I:x,V=u?H+T:H;return{width:X+(l?-I:I),height:A+(u?-T:T),x:r[0]*I*(l?-1:1)+z,y:r[1]*T*(u?-1:1)+V}}const He={width:0,height:0,x:0,y:0},gn={...He,pointerX:0,pointerY:0,aspectRatio:1};function pn(t){return[[0,0],[t.measured.width,t.measured.height]]}function mn(t,e,i){const s=e.position.x+t.position.x,n=e.position.y+t.position.y,r=t.measured.width??0,o=t.measured.height??0,a=i[0]*r,l=i[1]*o;return[[s-a,n-l],[s+r-a,n+o-l]]}function ti({domNode:t,nodeId:e,getStoreItems:i,onChange:s,onEnd:n}){const r=wt(t);let o={controlDirection:se("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};function a({controlPosition:u,boundaries:f,keepAspectRatio:c,resizeDirection:d,onResizeStart:p,onResize:h,onResizeEnd:g,shouldResize:b}){let m={...He},v={...gn};o={boundaries:f,resizeDirection:d,keepAspectRatio:c,controlDirection:se(u)};let x,H=null,X=[],A,$,I,T=!1;const S=ce().on("start",M=>{const{nodeLookup:y,transform:w,snapGrid:C,snapToGrid:E,nodeOrigin:z,paneDomNode:V}=i();if(x=y.get(e),!x)return;H=(V==null?void 0:V.getBoundingClientRect())??null;const{xSnapped:N,ySnapped:P}=ht(M.sourceEvent,{transform:w,snapGrid:C,snapToGrid:E,containerBounds:H});m={width:x.measured.width??0,height:x.measured.height??0,x:x.position.x??0,y:x.position.y??0},v={...m,pointerX:N,pointerY:P,aspectRatio:m.width/m.height},A=void 0,x.parentId&&(x.extent==="parent"||x.expandParent)&&(A=y.get(x.parentId),$=A&&x.extent==="parent"?pn(A):void 0),X=[],I=void 0;for(const[O,D]of y)if(D.parentId===e&&(X.push({id:O,position:{...D.position},extent:D.extent}),D.extent==="parent"||D.expandParent)){const B=mn(D,x,D.origin??z);I?I=[[Math.min(B[0][0],I[0][0]),Math.min(B[0][1],I[0][1])],[Math.max(B[1][0],I[1][0]),Math.max(B[1][1],I[1][1])]]:I=B}p==null||p(M,{...m})}).on("drag",M=>{const{transform:y,snapGrid:w,snapToGrid:C,nodeOrigin:E}=i(),z=ht(M.sourceEvent,{transform:y,snapGrid:w,snapToGrid:C,containerBounds:H}),V=[];if(!x)return;const{x:N,y:P,width:O,height:D}=m,B={},L=x.origin??E,{width:F,height:q,x:U,y:R}=xn(v,o.controlDirection,z,o.boundaries,o.keepAspectRatio,L,$,I),W=F!==O,k=q!==D,K=U!==N&&W,G=R!==P&&k;if(!K&&!G&&!W&&!k)return;if((K||G||L[0]===1||L[1]===1)&&(B.x=K?U:m.x,B.y=G?R:m.y,m.x=B.x,m.y=B.y,X.length>0)){const Z=U-N,J=R-P;for(const et of X)et.position={x:et.position.x-Z+L[0]*(F-O),y:et.position.y-J+L[1]*(q-D)},V.push(et)}if((W||k)&&(B.width=W&&(!o.resizeDirection||o.resizeDirection==="horizontal")?F:m.width,B.height=k&&(!o.resizeDirection||o.resizeDirection==="vertical")?q:m.height,m.width=B.width,m.height=B.height),A&&x.expandParent){const Z=L[0]*(B.width??0);B.x&&B.x<Z&&(m.x=Z,v.x=v.x-(B.x-Z));const J=L[1]*(B.height??0);B.y&&B.y<J&&(m.y=J,v.y=v.y-(B.y-J))}const j=yn({width:m.width,prevWidth:O,height:m.height,prevHeight:D,affectsX:o.controlDirection.affectsX,affectsY:o.controlDirection.affectsY}),_={...m,direction:j};(b==null?void 0:b(M,_))!==!1&&(T=!0,h==null||h(M,_),s(B,V))}).on("end",M=>{T&&(g==null||g(M,{...m}),n==null||n({...m}),T=!1)});r.call(S)}function l(){r.on(".drag",null)}return{update:a,destroy:l}}export{de as $,Ce as A,Gt as B,pt as C,Vt as D,Jn as E,ti as F,Zn as G,jn as H,Ht as I,Be as J,In as K,Vn as L,St as M,bn as N,_e as O,Y as P,st as Q,ie as R,Rt as S,Wn as T,Hn as U,Xn as V,Ye as W,Qn as X,le as Y,tt as Z,Yn as _,zt as a,En as a0,Kn as a1,qn as a2,ft as a3,Je as a4,kn as a5,Sn as a6,Un as a7,Cn as a8,ve as a9,An as aa,vn as b,De as c,We as d,At as e,Ve as f,$n as g,Tn as h,Pn as i,Bn as j,Pe as k,_n as l,Nn as m,Et as n,rt as o,Xt as p,Gn as q,Bt as r,Fn as s,Ln as t,Dn as u,Rn as v,zn as w,On as x,qe as y,dt as z};
